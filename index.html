<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Your Better Day</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Favicon and icons -->
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="icon" type="image/png" sizes="32x32" href="logo-32.png">
  <link rel="icon" type="image/png" sizes="192x192" href="logo-192.png">
  <link rel="apple-touch-icon" sizes="180x180" href="logo-192.png">

  <!-- Social sharing -->
  <meta name="description" content="A thoughtful compliment and a daily affirmation, tailored to you.">
  <meta property="og:title" content="Your Better Day">
  <meta property="og:description" content="A thoughtful compliment and a daily affirmation, tailored to you.">
  <meta property="og:image" content="https://yourbetter.day/logo-1024.png">
  <meta property="og:url" content="https://yourbetter.day/">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="theme-color" content="#2F9E7E">

  <style>
    /* Reset */
    *,*::before,*::after{box-sizing:border-box}

    /* Calm Focus palette */
    :root{
      --bg:#F6FBF8;
      --surface:#FFFFFF;
      --text:#142022;
      --muted:#5B6E69;
      --primary:#2F9E7E;
      --primary-hover:#27866B;
      --accent:#F1B24A;
      --outline:#C7E6D9;
      --danger:#E35B5B;
      --shadow:0 6px 24px rgba(0,0,0,.08),0 2px 6px rgba(0,0,0,.06);
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0E1516;
        --surface:#0F1A1B;
        --text:#EAF1EE;
        --muted:#99ADA8;
        --primary:#3FB294;
        --primary-hover:#34A183;
        --accent:#E7A94A;
        --outline:#214742;
        --shadow:0 6px 24px rgba(0,0,0,.5),0 2px 6px rgba(0,0,0,.35);
      }
    }

    /* Layout */
    html,body{height:100%;margin:0}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);color:var(--text);line-height:1.55;
      display:grid;grid-template-rows:auto 1fr auto;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
    }
    .container{max-width:920px;margin:0 auto;padding:28px 16px 20px;width:100%}
    header{text-align:center;margin-bottom:12px}
    .logo{width:84px;height:84px;object-fit:contain;border-radius:50%;display:block;margin:0 auto 10px}
    h1{margin:0 0 6px 0;font-size:clamp(1.4rem,2.2vw,1.9rem)}
    .muted{font-size:.95rem;color:var(--muted)}
    .card{background:var(--surface);border:1px solid var(--outline);border-radius:14px;padding:18px;box-shadow:var(--shadow);overflow:hidden}
    .stack{display:grid;gap:16px}
    .stack-lg{display:grid;gap:22px}

    /* Form */
    label{display:block;margin-top:14px;font-weight:600}
    input,textarea{
      width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--outline);
      background:var(--surface);color:var(--text);font:inherit;outline:none;
      min-width:0
    }
    input:focus,textarea:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(47,158,126,.2)}
    textarea{min-height:120px;resize:vertical}

    .btn-row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .btn{
      appearance:none;border:0;border-radius:12px;padding:12px 18px;font:inherit;cursor:pointer;
      background:var(--primary);color:#fff;transition:transform .04s ease,background-color .15s ease
    }
    .btn:hover{background:var(--primary-hover)}
    .btn:active{transform:translateY(1px)}
    .btn:disabled{opacity:.7;cursor:not-allowed}
    .btn-secondary{background:transparent;color:var(--primary);border:1px solid var(--primary)}
    .btn-secondary:hover{background:rgba(47,158,126,.08)}

    .notice{padding:10px 12px;border-radius:10px;border:1px solid var(--outline);background:rgba(241,178,74,.12);color:var(--text);font-size:.95rem}
    .notice.error{border-color:rgba(227,91,91,.4);background:rgba(227,91,91,.12)}
    .results{display:none}
    .results h2{margin:0 0 8px 0;font-size:1.2rem}
    .results pre{white-space:pre-wrap;word-wrap:break-word;margin:0;font-family:inherit;line-height:1.6}

    footer{padding:18px 16px 28px;color:var(--muted);text-align:center;font-size:.9rem}
    footer a{color:var(--primary);text-decoration:none}
    footer a:hover{text-decoration:underline}

    @media (min-width:760px){
      .twocol{display:grid;grid-template-columns:minmax(0,1fr) minmax(0,1fr);gap:16px}
      .twocol > div{min-width:0}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="logo.png" alt="Your Better Day logo" class="logo">
      <h1>Your Better Day</h1>
      <p class="muted">
        This site will collect some personal information about you in order to generate a customized compliment and affirmation to brighten your day. We do not retain or sell your personal information. There's no database retaining any of this, as far as I (the creator) know. However, feel free to use nicknames, and, or stand in information. But obviously it will be more useful, for you, if you provide accurate info.
      </p>
    </header>

    <section class="card stack-lg" aria-labelledby="formTitle">
      <h2 id="formTitle" style="margin:0;font-size:1.1rem;">Tell us a bit about you</h2>

      <form id="complimentForm" class="stack" novalidate>
        <div class="twocol">
          <div>
            <label>Name
              <input type="text" id="name" placeholder="Jo Doe" required maxlength="250">
            </label>
          </div>

          <div>
            <label>Date of Birth
              <input type="text" id="dob" placeholder="MM/DD/YYYY or MM/DD" required maxlength="250">
            </label>
          </div>
        </div>

        <div class="twocol">
          <div>
            <label>Biggest personal fear
              <input type="text" id="fear" placeholder="Spiders, failure, the inevitable heat death of the universe" required maxlength="250">
            </label>
          </div>

          <div>
            <label>Favorite color
              <input type="text" id="color" placeholder="Orange, Maroon, Sunsets Over Water..." required maxlength="250">
            </label>
          </div>
        </div>

        <div class="twocol">
          <div>
            <label>A word you resonate with recently
              <input type="text" id="word" placeholder="I don't think you need examples of words" required maxlength="250">
            </label>
          </div>

          <div>
            <label>Favorite book
              <input type="text" id="book" placeholder="I really like The Hobbit. But put whatever you like!" required maxlength="250">
            </label>
          </div>
        </div>

        <div>
          <label>Something you have been concerned about lately
            <textarea id="concern" placeholder="This is the place for something more immediate than your biggest fear. Maybe you're worried about your physical health? Getting a promotion? Losing your car keys?" required maxlength="1000"></textarea>
          </label>
        </div>

        <div class="btn-row">
          <button type="submit" id="submitBtn" class="btn">Submit</button>
          <div id="hint" class="muted" aria-live="polite"></div>
        </div>

        <div id="rateMsg" class="notice error" style="display:none;"></div>
      </form>
    </section>

    <section id="results" class="results card stack" aria-live="polite">
      <div class="stack">
        <h2>Compliment</h2>
        <pre id="compliment"></pre>
        <div class="btn-row">
          <button class="btn-secondary" id="copyCompliment">Copy compliment</button>
          <button class="btn-secondary" id="shareCompliment">Share</button>
        </div>
      </div>

      <div class="stack">
        <h2>Daily Affirmation</h2>
        <pre id="affirmation"></pre>
        <div class="btn-row">
          <button class="btn-secondary" id="copyAffirmation">Copy affirmation</button>
          <button class="btn-secondary" id="shareAffirmation">Share</button>
        </div>
      </div>
    </section>
  </div>

  <footer>
    <p>
      This site offers supportive messages for general encouragement. It is not a medical, psychiatric, or mental health service. If you are in crisis, call your local emergency number or a trusted help line in your region.
    </p>
    <p class="muted">Â© <span id="year"></span> YourBetter.day</p>
  </footer>

  <script>
    // Route
    const API_URL = "https://r4x78qtoq3.execute-api.us-east-1.amazonaws.com/compliment";

    // Limit
    const DAILY_LIMIT = 5;
    function todayKey(){
      const d = new Date();
      return `ybd_hits_${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`;
    }
    function readHits(){ const raw = localStorage.getItem(todayKey()); return raw ? parseInt(raw,10)||0 : 0; }
    function incHits(){ localStorage.setItem(todayKey(), String(readHits()+1)); }

    // Elements
    const form = document.getElementById("complimentForm");
    const results = document.getElementById("results");
    const complimentEl = document.getElementById("compliment");
    const affirmationEl = document.getElementById("affirmation");
    const submitBtn = document.getElementById("submitBtn");
    const hint = document.getElementById("hint");
    const rateMsg = document.getElementById("rateMsg");
    const copyComplimentBtn = document.getElementById("copyCompliment");
    const copyAffirmationBtn = document.getElementById("copyAffirmation");
    const shareComplimentBtn = document.getElementById("shareCompliment");
    const shareAffirmationBtn = document.getElementById("shareAffirmation");

    // Footer year
    document.getElementById("year").textContent = new Date().getFullYear();

    // Fetch helper
    async function postWithTimeout(url,data,ms){
      const controller=new AbortController();
      const t=setTimeout(()=>controller.abort(),ms);
      try{
        const res=await fetch(url,{
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body:JSON.stringify(data),
          cache:"no-store",
          signal:controller.signal
        });
        return res;
      } finally { clearTimeout(t); }
    }

    // Share helper
    async function shareText(title,text){
      const shareUrl = location.origin;
      if(navigator.share){
        try{ await navigator.share({ title, text, url: shareUrl }); return; }catch(_){}
      }
      const msg = encodeURIComponent(text + "\n\n" + shareUrl);
      window.open("https://twitter.com/intent/tweet?text=" + msg, "_blank", "noopener,noreferrer");
    }

    // Disable
    function setDisabled(on){
      submitBtn.disabled = on;
      [...form.elements].forEach(e => { if(e!==submitBtn) e.disabled = on; });
    }

    // Rate limit
    function checkLimit(){
      const hits = readHits();
      if(hits >= DAILY_LIMIT){
        rateMsg.style.display = "block";
        rateMsg.textContent = `Daily limit reached, you can submit up to ${DAILY_LIMIT} times per day from this browser.`;
        return false;
      }
      rateMsg.style.display = "none";
      return true;
    }

    // Submit
    form.addEventListener("submit", async (e)=>{
      e.preventDefault();
      if(!checkLimit()) return;

      hint.textContent = "";
      setDisabled(true);
      const original = submitBtn.textContent;
      submitBtn.textContent = "Thinking...";

      const data = {
        name: document.getElementById("name").value.trim(),
        dob: document.getElementById("dob").value.trim(),
        fear: document.getElementById("fear").value.trim(),
        color: document.getElementById("color").value.trim(),
        word: document.getElementById("word").value.trim(),
        book: document.getElementById("book").value.trim(),
        concern: document.getElementById("concern").value.trim()
      };

      // Clamp
      const limits = { name:250, dob:250, fear:250, color:250, word:250, book:250, concern:1000 };
      for(const k in limits){ data[k] = (data[k] || "").slice(0, limits[k]); }

      try{
        const res = await postWithTimeout(API_URL, data, 30000);
        if(!res.ok){
          const text = await res.text();
          throw new Error(`API ${res.status} ${text}`);
        }
        const json = await res.json();
        complimentEl.textContent = json.compliment || "(no text returned)";
        affirmationEl.textContent = json.affirmation || "(no text returned)";
        results.style.display = "grid";
        window.scrollTo({ top: results.offsetTop - 8, behavior: "smooth" });
        incHits();
      }catch(err){
        results.style.display = "grid";
        complimentEl.textContent = "Sorry, something went wrong.";
        affirmationEl.textContent = String(err);
        hint.textContent = "If this keeps happening, refresh and try again.";
      }finally{
        setDisabled(false);
        submitBtn.textContent = original;
      }
    });

    // Copy and share
    copyComplimentBtn.addEventListener("click", async ()=>{
      try{
        await navigator.clipboard.writeText(complimentEl.textContent || "");
        hint.textContent = "Compliment copied.";
        setTimeout(()=>hint.textContent="",1800);
      }catch{ hint.textContent = "Copy did not work on this device."; }
    });
    copyAffirmationBtn.addEventListener("click", async ()=>{
      try{
        await navigator.clipboard.writeText(affirmationEl.textContent || "");
        hint.textContent = "Affirmation copied.";
        setTimeout(()=>hint.textContent="",1800);
      }catch{ hint.textContent = "Copy did not work on this device."; }
    });
    shareComplimentBtn.addEventListener("click", ()=>shareText("Your Better Day - Compliment", complimentEl.textContent || ""));
    shareAffirmationBtn.addEventListener("click", ()=>shareText("Your Better Day - Affirmation", affirmationEl.textContent || ""));

    console.log("Using API_URL:", API_URL);
  </script>
</body>
</html>
